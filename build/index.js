(()=>{"use strict";const e=window.React,t=window.wp.hooks,o=window.wp.compose,r=window.wp.blockEditor,n=window.wp.components,l=window.wp.i18n,i=window.wp.element;(0,t.addFilter)("blocks.registerBlockType","hm-query-loop/add-query-loop-attributes",function(e,t){return"core/query"!==t?e:{...e,attributes:{...e.attributes,hmQueryLoop:{type:"object",default:{}}},providesContext:{...e.providesContext||{},"hm-query-loop/settings":"hmQueryLoop"}}}),(0,t.addFilter)("blocks.registerBlockType","hm-query-loop/add-post-template-context",function(e,t){return"core/post-template"!==t?e:{...e,usesContext:[...e.usesContext||[],"hm-query-loop/settings"]}});const p=(0,o.createHigherOrderComponent)(t=>o=>{const{name:p,attributes:s,setAttributes:a,clientId:u}=o;if("core/query"!==p)return(0,e.createElement)(t,{...o});const{hmQueryLoop:c={},query:d={}}=s,{perPage:m,hideOnPaged:h,excludeDisplayed:y}=c,g=d.inherit||!1,w=window.hmQueryLoopSettings?.postsPerPage||10;return(0,i.useEffect)(()=>{void 0!==m&&m>0&&d.perPage!==m&&a({query:{...d,perPage:m}})},[m]),(0,e.createElement)(e.Fragment,null,(0,e.createElement)(t,{...o}),(0,e.createElement)(r.InspectorControls,null,(0,e.createElement)(n.PanelBody,{title:(0,l.__)("Extra Query Loop Settings","hm-query-loop"),initialOpen:!1},g&&(0,e.createElement)(n.TextControl,{label:(0,l.__)("Posts per page (Override)","hm-query-loop"),help:(0,l.__)("Override the number of posts to show when inheriting the query. Maximum value is limited to the site's posts per page setting.","hm-query-loop"),type:"number",value:null!=m?m:"",onChange:e=>{const t=""===e?void 0:parseInt(e,10);a({hmQueryLoop:{...c,perPage:t}})},min:1,max:w}),!g&&m&&(0,e.createElement)("p",{style:{fontSize:"12px",color:"#757575"}},(0,l.__)("Posts per page override is only available when inheriting the query.","hm-query-loop")),(0,e.createElement)(n.ToggleControl,{label:(0,l.__)("Hide on paginated pages","hm-query-loop"),help:(0,l.__)("Hide this query loop when viewing page 2 or higher.","hm-query-loop"),checked:h,onChange:e=>a({hmQueryLoop:{...c,hideOnPaged:e}})}),(0,e.createElement)(n.ToggleControl,{label:(0,l.__)("Exclude already displayed posts","hm-query-loop"),help:(0,l.__)("Exclude posts that have been displayed by previous query loops on this page.","hm-query-loop"),checked:y,onChange:e=>a({hmQueryLoop:{...c,excludeDisplayed:e}})}))))},"withInspectorControls");(0,t.addFilter)("editor.BlockEdit","hm-query-loop/with-inspector-controls",p);const s=(0,o.createHigherOrderComponent)(t=>o=>{const{name:r,context:n,clientId:l}=o;if("core/post-template"!==r)return(0,e.createElement)(t,{...o});const i=n?.["hm-query-loop/settings"]||{},{perPage:p}=i;if(p&&p>0){const r=`\n\t\t\t\t[data-block="${l}"] .wp-block-post:nth-child(n+${p+2}) {\n\t\t\t\t\tdisplay: none !important;\n\t\t\t\t}\n\t\t\t`;return(0,e.createElement)(e.Fragment,null,(0,e.createElement)("style",null,r),(0,e.createElement)(t,{...o}))}return(0,e.createElement)(t,{...o})},"withPostTemplateStyles");(0,t.addFilter)("editor.BlockEdit","hm-query-loop/with-post-template-styles",s),(0,t.addFilter)("blocks.getSaveContent.extraProps","hm-query-loop/add-save-props",function(e,t,o){return t.name,e})})();